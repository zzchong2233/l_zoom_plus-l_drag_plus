$.fn.extend({
	l_zoom: function(limit,scale) {
		if(limit == undefined){
			limit = 10;
		}
		if(scale == undefined){
			scale = 1;
		}else{
			var ratio = 1 / scale;
			scale = ratio;
		}
		this.css("position", "absolute");
		var id = '';
		if(this[0].id != undefined)
				var id = "#" + this[0].id;
		//自由拖动
		var a = "free";
		$(this).attr("l_zoom_mode", a);
		//不重复添加hanlder
		var length = $(id + " .zoom_right").length;
		if(length == 0){
			var b = $('<div class="zoom zoom_right drag"></div><div class="zoom zoom_lt drag"></div><div class="zoom zoom_lb drag"></div><div class="zoom zoom_rt drag"></div><div class="zoom zoom_left drag"></div><div class="zoom zoom_rb drag"></div><div class="zoom zoom_bottom drag"></div><div class="zoom zoom_top drag"></div>');
			this.append(b);
		}
    //开始拖动边框
		$(id + " .zoom_right").mousedown(function(h) {
			var g = $(this);
			var h = event || window.event;
			h.stopPropagation();
			var f = parseInt(g.parent().css("width"));
			var d = {
				x: h.clientX,
				y: h.clientY
			};
      //获取鼠标位置
			window.onmousemove = function(i) {
				var i = event || window.event;
        var width = f + scale * (i.clientX - d.x);
        if(width >= limit)
				    g.parent().css("width",width);
			};
			window.onmouseup = function(i) {
				var i = event || window.event;
        //注销窗口移动事件
				window.onmousemove = null
			}
		});
    //开始拖动边框
		$(id + " .zoom_left").mousedown(function(h) {
			var g = $(this);
			var h = event || window.event;
			h.stopPropagation();
			var f = parseInt(g.parent().css("width"));
      var left = parseInt(g.parent().css("left"));
			var d = {
				x: h.clientX,
				y: h.clientY
			};
      //获取鼠标位置
			window.onmousemove = function(i) {
        var x = {
          x: i.clientX,
          y: i.clientY
        };
        var width = f - scale * (i.clientX - d.x);
        if(width > limit){
          g.parent().css("left", left +  scale * (i.clientX - d.x));
          g.parent().css("width",width);
        }
			};
			window.onmouseup = function(i) {
				var i = event || window.event;
        //注销窗口移动事件
				window.onmousemove = null
			}
		});

    //拖动下方
		$(id + " .zoom_bottom").mousedown(function(h) {
      console.log(1);
			var f = $(this);
			var h = event || window.event;
			h.stopPropagation();
			var g = parseInt(f.parent().css("height"));
			var d = {
				x: h.clientX,
				y: h.clientY
			};
			window.onmousemove = function(i) {
				var i = event || window.event;
        var height =  g + scale * (i.clientY - d.y);
        if(height >= limit)
				    f.parent().css("height", height);
			};
			window.onmouseup = function(i) {
				var i = event || window.event;
				window.onmousemove = null
			}
		});

    //拖动上方
    $(id + " .zoom_top").mousedown(function(h) {
      var f = $(this);
      var h = event || window.event;
      h.stopPropagation();
      var g = parseInt(f.parent().css("height"));
      var top = parseInt(f.parent().css("top"));
      var d = {
        x: h.clientX,
        y: h.clientY
      };
      window.onmousemove = function(i) {
        var x = {
          x: i.clientX,
          y: i.clientY
        };
        var i = event || window.event;
        var height =  g - scale * (i.clientY - d.y);
        if(height >= limit){
          f.parent().css("top",top - scale * (h.clientY - x.y));
          f.parent().css("height", height);
        }
      };
      window.onmouseup = function(i) {
        var i = event || window.event;
        window.onmousemove = null
      }
    });
    //拖动右下角
		$(id + " .zoom_rb").mousedown(function(i) {
			var g = $(this);
			var i = event || window.event;
			i.stopPropagation();
			var f = parseInt(g.parent().css("width"));
			var h = parseInt(g.parent().css("height"));
			var d = {
				x: i.clientX,
				y: i.clientY
			};
			window.onmousemove = function(l) {
				var l = event || window.event;
				if (g.parent().attr("l_zoom_mode") === "free") {
					g.parent().css({
						"width": f + scale * (l.clientX - d.x),
						"height": h + scale * (l.clientY - d.y)
					});
					if (parseInt(g.parent().css("width")) <= limit) {
						g.parent().css("width", limit)
					}
					if (parseInt(g.parent().css("height")) <= limit) {
						g.parent().css("height", limit)
					}
				}
			};
			window.onmouseup = function(j) {
				var j = event || window.event;
				window.onmousemove = null
			}
		});

		//拖动右上角
		$(id + " .zoom_rt").mousedown(function(i) {
			var flag  = false;
			var g = $(this);
			var i = event || window.event;
			i.stopPropagation();
			var f = parseInt(g.parent().css("width"));
			var h = parseInt(g.parent().css("height"));
			var top = parseInt(g.parent().css("top"));
			var temp;
			var d = {
				x: i.clientX,
				y: i.clientY
			};
			window.onmousemove = function(l) {
				var l = event || window.event;
				var width = f + scale * (l.clientX - d.x);
				var height = h - scale * (l.clientY - d.y);
				if (g.parent().attr("l_zoom_mode") === "free") {
						if (width >= limit) {
							g.parent().css("width", width);
						}
						if (height >= limit) {
							g.parent().css("height", height);
							g.parent().css("top", top + scale * (l.clientY - d.y));
							flag = true;
						}
				}
			};
			window.onmouseup = function(j) {
				var j = event || window.event;
				window.onmousemove = null
			}
		});

		//拖动左上角
		$(id + " .zoom_lt").mousedown(function(i) {
			var flag  = false;
			var g = $(this);
			var i = event || window.event;
			i.stopPropagation();
			var f = parseInt(g.parent().css("width"));
			var h = parseInt(g.parent().css("height"));
			var top = parseInt(g.parent().css("top"));
			var left = parseInt(g.parent().css("left"));
			var temp;
			var d = {
				x: i.clientX,
				y: i.clientY
			};
			window.onmousemove = function(l) {
				var l = event || window.event;
				var width = f - scale * (l.clientX - d.x);
				var height = h - scale * (l.clientY - d.y);
				if (g.parent().attr("l_zoom_mode") === "free") {
						if (width >= limit) {
							g.parent().css("width", width);
							g.parent().css("left", left + scale * (l.clientX - d.x));
						}
						if (height >= limit) {
							g.parent().css("height", height);
							g.parent().css("top", top + scale * (l.clientY - d.y));
							flag = true;
						}
				}
			};
			window.onmouseup = function(j) {
				var j = event || window.event;
				window.onmousemove = null
			}
		});

		//拖动左下角
		$(id + " .zoom_lb").mousedown(function(i) {
			var flag  = false;
			var g = $(this);
			var i = event || window.event;
			i.stopPropagation();
			var f = parseInt(g.parent().css("width"));
			var h = parseInt(g.parent().css("height"));
			var left = parseInt(g.parent().css("left"));
			var temp;
			var d = {
				x: i.clientX,
				y: i.clientY
			};
			window.onmousemove = function(l) {
				var l = event || window.event;
				var width = f - scale * (l.clientX - d.x);
				var height = h + scale * (l.clientY - d.y);
				if (g.parent().attr("l_zoom_mode") === "free") {
						if (width >= limit) {
							g.parent().css("width", width);
							g.parent().css("left", left + scale * (l.clientX - d.x));
						}
						if (height >= limit) {
							g.parent().css("height", height);
							flag = true;
						}
				}
			};
			window.onmouseup = function(j) {
				var j = event || window.event;
				window.onmousemove = null
			}
		});


		return this
	}
});
